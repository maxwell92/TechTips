基于Kubernetes的私有容器云建设实践
====================================

非常感谢颖杰提供了这么好的分享平台。今天，很高兴为大家介绍易宝支付基于*Kubernetes*构建私有容器云的实践。

今天的分享分为如下几个部分：

* 背景介绍

* 技术选型

* 以*Kubernetes*为中心构建容器云

* 高可用与资源QoS/超卖

* 容器云管理系统建设

* 应用的迁移和改造

* *CI/CD*平台建设

* 未来展望

### 背景介绍
--------------------

在*Docker*技术流行开来之前，保证软件交付的质量和速度对于大多数企业来说都是困难的。业务的复杂性造成了应用的复杂性，面对成千上万的不同应用，运维部门需要时刻应对来着不同应用、不同环境的挑战。特别是在自动化运维程度不高的企业，“人肉运维”成了解决问题的手段，人肉运维造成了软件交付的周期漫长，人为事故风险很高。

2013年，*Docker*横空出世，一举改变了软件交付的生态。大家都知道，*Docker*的理念是"Build once, Ship anywhere"，它为我们提供了一种全新的交付方式，*Docker*镜像的不可变性和*Dockerfile*的自描述特性，让交付环节省去了大量的沟通成本；*Docker*的秒级启动，让部署的时间成本缩小了几个数量级。

我们是在2015年6月份开始研究*Docker*，由于*Docker*能够快速上手，在调研*Docker*的前两周，并没有觉得*Docker*能够带来多大变化，随着研究的深入，越来越觉得*Docker*虽然不是新技术，但它引领了一种全新的理念。


### 技术选型
--------------------

现在大家都熟知的容器编排界三足鼎立的局面，在2015年8月份，我们要做技术选型时，*Kubernetes*, *Mesos*, *Swarm*各自的优势和劣势还没有现在这么清晰。当时*Mesos*还是0.9的版本，由于它偏重资源抽象，容器编排和服务发现需要*marathon*完成，由于我司大多是*Java web*的应用，*Mesos*没有解决我们的主要问题，所以，*Mesos*成了最后的选择。当时*Swarm*还没发布1.0版本，虽然已经有了编排的基本功能，甚至支持多种调度策略，又轻量，小团队也能搞定（当时我们团队只有两个人），*Swarm*成为了一个选择。*Kubernetes*在当时是0.9版本，在一开始接触*Kubernetes*时，被它超前的理念吸引了。但是*Kubernetes*的门槛在最一开始就出现了，搞清楚*Kubernetes*的安装和各个组件的功能我们就用了差不多一个月的时间。随着对*Kubernetes*的了解的逐步深入，它的“以应用为中心”的理念正好是我们所要寻找的方案。能让运维轻松的应对应用的全生命周期管理是我们研究*Docker*的初衷，特别是*Kubernetes*的*ReplicationController*能够自动的维持实例个数，这个特性能够有效降低运维人员的心智负担和运维的人力成本。在技术选型的时，自主开发容器编排引擎也是一种声音，我们看到了*Kubernete*的超前理念和社区的活跃度，我们认为没有必要自己造轮子，所以毅然地选择了*Kubernetes*。





